<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Read a Blog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg:          #131109;
      --surface:     #1D1B12;
      --text:        #EAE0CC;
      --muted:       #7A7260;
      --accent:      #C9905C;
      --accent-dark: #A87040;
      --border:      #35322A;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Lora', Georgia, serif;
      min-height: 100svh;
      display: flex;
      flex-direction: column;
    }

    /* ─── Main ──────────────────────────────────── */

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 72px 24px 60px;
      gap: 56px;
    }

    .stage {
      width: 100%;
      max-width: 560px;
    }

    /* ─── Site header ───────────────────────────── */

    .site-header {
      text-align: center;
      max-width: 480px;
      width: 100%;
    }

    .site-name {
      font-size: clamp(2.2rem, 5vw, 3.2rem);
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 14px;
    }

    .site-name em {
      font-style: italic;
      font-weight: 400;
      opacity: 0.7;
    }

    /* ─── Explainer ─────────────────────────────── */

    .explainer {
      width: 100%;
      max-width: 480px;
      text-align: center;
      border-top: 1px solid var(--border);
      padding-top: 40px;
    }

    .explainer-label {
      font-size: 0.69rem;
      font-family: system-ui, -apple-system, sans-serif;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .explainer p {
      font-size: 0.875rem;
      font-family: system-ui, -apple-system, sans-serif;
      color: var(--muted);
      line-height: 1.8;
    }

    .explainer p + p {
      margin-top: 10px;
    }

    /* ─── Button view ───────────────────────────── */

    #btn-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    #read-btn {
      font-family: 'Lora', Georgia, serif;
      font-size: 1.25rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent);
      border: none;
      border-radius: 100px;
      padding: 20px 64px;
      cursor: pointer;
      box-shadow: 0 4px 24px rgba(201, 144, 92, 0.3);
      letter-spacing: 0.01em;
      transition:
        background   0.2s ease,
        transform    0.18s ease,
        box-shadow   0.2s ease;
    }

    #read-btn:hover:not(:disabled) {
      background: var(--accent-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(201, 144, 92, 0.5);
    }

    #read-btn:active:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 2px 12px rgba(201, 144, 92, 0.25);
    }

    #read-btn:disabled {
      cursor: default;
      opacity: 0.72;
    }

    #read-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 4px;
    }

    #error-msg {
      font-size: 0.85rem;
      color: var(--muted);
      font-style: italic;
    }

    /* ─── Card ──────────────────────────────────── */

    #card-area {
      display: none;
    }

    #post-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 40px 44px;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.4);
    }

    .card-source {
      font-size: 0.69rem;
      font-family: system-ui, -apple-system, sans-serif;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 14px;
    }

    .card-title {
      font-size: clamp(1.1rem, 2.8vw, 1.5rem);
      font-weight: 600;
      line-height: 1.44;
      color: var(--text);
      margin-bottom: 32px;
    }

    .card-actions {
      display: flex;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
    }

    .btn-read {
      display: inline-block;
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      padding: 12px 30px;
      border-radius: 100px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 0.875rem;
      font-weight: 500;
      letter-spacing: 0.01em;
      transition: background 0.15s ease, transform 0.15s ease;
    }

    .btn-read:hover {
      background: var(--accent-dark);
      transform: translateY(-1px);
    }

    .btn-read:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 3px;
    }

    .btn-another {
      background: none;
      border: none;
      color: var(--muted);
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 0.875rem;
      cursor: pointer;
      padding: 12px 0;
      text-decoration: underline;
      text-decoration-color: transparent;
      text-underline-offset: 3px;
      transition:
        color                  0.15s ease,
        text-decoration-color  0.15s ease;
    }

    .btn-another:hover {
      color: var(--text);
      text-decoration-color: var(--border);
    }

    .btn-another:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 3px;
      border-radius: 3px;
    }

    /* ─── Footer ────────────────────────────────── */

    footer {
      padding: 0 24px 52px;
      text-align: center;
    }

    .footer-divider {
      width: 40px;
      height: 1px;
      background: var(--border);
      margin: 0 auto 32px;
    }

    .footer-inner {
      max-width: 360px;
      margin: 0 auto;
    }

    .footer-label {
      font-size: 0.825rem;
      color: var(--muted);
      font-style: italic;
      margin-bottom: 6px;
    }

    .footer-hint {
      font-size: 0.75rem;
      font-family: system-ui, -apple-system, sans-serif;
      color: var(--muted);
      opacity: 0.7;
      margin-bottom: 14px;
    }

    .blog-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .blog-form input,
    .blog-form button {
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 0.825rem;
      border-radius: 7px;
    }

    .blog-form input {
      background: transparent;
      border: 1px solid var(--border);
      padding: 10px 14px;
      color: var(--text);
      outline: none;
      transition: border-color 0.15s ease;
    }

    .blog-form input::placeholder {
      color: var(--muted);
    }

    .blog-form input:focus {
      border-color: var(--accent);
    }

    .blog-form button {
      background: transparent;
      border: 1px solid var(--border);
      padding: 10px;
      color: var(--muted);
      cursor: pointer;
      outline: none;
      transition:
        border-color  0.15s ease,
        color         0.15s ease;
    }

    .blog-form button:hover,
    .blog-form button:focus-visible {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ─── Tablet (≤ 768px) ──────────────────────── */

    @media (max-width: 768px) {
      main {
        padding: 56px 20px 48px;
        gap: 44px;
      }

      #post-card {
        padding: 32px 32px;
      }
    }

    /* ─── Mobile (≤ 480px) ──────────────────────── */

    @media (max-width: 480px) {
      main {
        padding: 40px 16px 40px;
        gap: 36px;
      }

      #read-btn {
        width: 100%;
        font-size: 1.1rem;
        padding: 18px 24px;
      }

      #post-card {
        padding: 24px 20px;
        border-radius: 12px;
      }

      .card-title {
        font-size: 1.15rem;
        margin-bottom: 24px;
      }

      .card-actions {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }

      .btn-read {
        text-align: center;
        padding: 14px;
      }

      .btn-another {
        text-align: center;
        padding: 12px 0;
      }

      .explainer {
        padding-top: 32px;
      }

      footer {
        padding: 0 16px 40px;
      }

      .footer-inner {
        max-width: 100%;
      }
    }

    /* ─── Touch: disable hover lift effects ──────── */

    @media (hover: none) {
      #read-btn:hover:not(:disabled) {
        transform: none;
        box-shadow: 0 4px 24px rgba(201, 144, 92, 0.3);
      }

      .btn-read:hover {
        transform: none;
      }
    }
  </style>
</head>
<body>

  <main>

    <header class="site-header">
      <h1 class="site-name">Read <em>a</em> Blog</h1>
    </header>

    <section class="explainer">
      <p class="explainer-label">How it works</p>
      <p>Click the button and get a random post from a hand-picked list of personal blogs. Read it, or hit "Try Another" for something different.</p>
      <p>No feed to exhaust, no recommendations, no engagement metrics — just a post. Every blog here is reviewed and added by hand.</p>
    </section>

    <div class="stage">

      <!-- Initial state: big button -->
      <div id="btn-area">
        <button id="read-btn">Read a Blog</button>
        <p id="error-msg" style="display:none"></p>
      </div>

      <!-- Post card (revealed after fetch) -->
      <div id="card-area">
        <article id="post-card">
          <p class="card-source" id="card-blog"></p>
          <h2 class="card-title" id="card-title"></h2>
          <div class="card-actions">
            <a class="btn-read" id="card-link" href="#" target="_blank" rel="noopener noreferrer">
              Read Post &rarr;
            </a>
            <button class="btn-another" id="btn-another">Try Another</button>
          </div>
        </article>
      </div>

    </div>

  </main>

  <footer>
    <div class="footer-divider"></div>
    <div class="footer-inner">
      <p class="footer-label">Have a blog?</p>
      <p class="footer-hint">Make sure it has an RSS feed.</p>
      <form id="blog-form" class="blog-form" novalidate>
        <input id="input-url"  type="url"  placeholder="Blog URL"              autocomplete="off">
        <input id="input-name" type="text" placeholder="Your name (optional)"  autocomplete="off">
        <!-- Honeypot: hidden from humans, bots fill it in -->
        <input id="input-trap" type="text" name="website" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0;pointer-events:none;" aria-hidden="true">
        <button type="submit">Submit &rarr;</button>
      </form>
    </div>
  </footer>

  <script>
    /* ── Config ──────────────────────────────────── */

    const feeds = [
      "https://www.paulgraham.com/rss.html",
      "https://simonwillison.net/atom/everything/"
    ];

    const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeW6icje8Lrm2LwJf51H5SpdufMQMcbSiUmRthoc8I8YQ20yg/viewform';
    const RSS2JSON = 'https://api.rss2json.com/v1/api.json?rss_url=';

    /* ── State ───────────────────────────────────── */

    let allPosts = null;
    let current  = null;

    /* ── Data fetching ───────────────────────────── */

    async function loadFeeds() {
      const results = await Promise.allSettled(
        feeds.map(url =>
          fetch(RSS2JSON + encodeURIComponent(url))
            .then(r => { if (!r.ok) throw new Error('Network error'); return r.json(); })
        )
      );

      const posts = [];
      for (const r of results) {
        if (r.status !== 'fulfilled' || r.value.status !== 'ok') continue;
        const blogName = r.value.feed.title;
        for (const item of r.value.items) {
          if (item.title && item.link) {
            posts.push({
              title: item.title.trim(),
              link:  item.link,
              blog:  blogName,
            });
          }
        }
      }
      return posts;
    }

    function pickRandom(pool, exclude = null) {
      const available = exclude ? pool.filter(p => p !== exclude) : pool;
      const source    = available.length > 0 ? available : pool;
      return source[Math.floor(Math.random() * source.length)] ?? null;
    }

    /* ── DOM helpers ─────────────────────────────── */

    function setCardContent(post) {
      document.getElementById('card-blog').textContent  = post.blog;
      document.getElementById('card-title').textContent = post.title;
      document.getElementById('card-link').href         = post.link;
    }

    // First reveal: button fades out, card fades+rises in
    function revealCard(post) {
      setCardContent(post);

      const btnArea  = document.getElementById('btn-area');
      const cardArea = document.getElementById('card-area');
      const card     = document.getElementById('post-card');

      // Fade button out
      btnArea.style.transition = 'opacity 0.22s ease';
      btnArea.style.opacity    = '0';

      setTimeout(() => {
        btnArea.style.display = 'none';

        // Set card to starting (invisible) position before showing
        card.style.transition = 'none';
        card.style.opacity    = '0';
        card.style.transform  = 'translateY(22px)';
        cardArea.style.display = 'block';

        // Trigger transition on next paint
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            card.style.transition = [
              'opacity   0.48s cubic-bezier(0.2, 0.8, 0.3, 1)',
              'transform 0.48s cubic-bezier(0.2, 0.8, 0.3, 1)',
            ].join(', ');
            card.style.opacity   = '1';
            card.style.transform = 'translateY(0)';
          });
        });
      }, 240);
    }

    // Subsequent swaps: quick fade out → update → fade back in
    function swapCard(post) {
      const card = document.getElementById('post-card');

      card.style.transition = 'opacity 0.16s ease, transform 0.16s ease';
      card.style.opacity    = '0';
      card.style.transform  = 'translateY(10px)';

      setTimeout(() => {
        setCardContent(post);
        card.style.transition = [
          'opacity   0.38s cubic-bezier(0.2, 0.8, 0.3, 1)',
          'transform 0.38s cubic-bezier(0.2, 0.8, 0.3, 1)',
        ].join(', ');
        card.style.opacity   = '1';
        card.style.transform = 'translateY(0)';
      }, 170);
    }

    /* ── Event handlers ──────────────────────────── */

    const readBtn  = document.getElementById('read-btn');
    const errorMsg = document.getElementById('error-msg');

    readBtn.addEventListener('click', async () => {
      readBtn.disabled       = true;
      readBtn.textContent    = 'Finding something good\u2026';
      errorMsg.style.display = 'none';

      try {
        if (!allPosts) allPosts = await loadFeeds();

        if (allPosts.length === 0) throw new Error('No posts found');

        current = pickRandom(allPosts);
        revealCard(current);

      } catch {
        errorMsg.textContent   = 'Couldn\u2019t load any posts. Please try again.';
        errorMsg.style.display = 'block';
        readBtn.disabled       = false;
        readBtn.textContent    = 'Read a Blog';
      }
    });

    document.getElementById('btn-another').addEventListener('click', () => {
      if (!allPosts || allPosts.length === 0) return;
      current = pickRandom(allPosts, current);
      swapCard(current);
    });

    const RATE_LIMIT_MS = 10 * 60 * 1000; // 10 minutes

    document.getElementById('blog-form').addEventListener('submit', e => {
      e.preventDefault();
      const blogUrl   = document.getElementById('input-url').value.trim();
      const name      = document.getElementById('input-name').value.trim();
      const honeypot  = document.getElementById('input-trap').value;
      const submitBtn = e.target.querySelector('button[type="submit"]');

      // Honeypot triggered — bot detected, silently drop
      if (honeypot) return;

      // Rate limit — one submission per 10 minutes per browser
      const lastSubmit = parseInt(localStorage.getItem('rab_last_submit') || '0', 10);
      if (Date.now() - lastSubmit < RATE_LIMIT_MS) {
        submitBtn.textContent = 'Please wait a bit!';
        setTimeout(() => { submitBtn.textContent = 'Submit \u2192'; }, 2500);
        return;
      }

      // POST directly to Google Forms — no redirect, data goes straight to the Sheet
      fetch(GOOGLE_FORM_URL.replace('/viewform', '/formResponse'), {
        method: 'POST',
        mode:   'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
          'entry.487552982':  blogUrl,
          'entry.1528747364': name,
        }),
      });

      // Optimistic confirmation — no response comes back with no-cors
      localStorage.setItem('rab_last_submit', Date.now().toString());
      e.target.reset();
      submitBtn.textContent = 'Thanks!';
      submitBtn.disabled    = true;
      setTimeout(() => {
        submitBtn.textContent = 'Submit \u2192';
        submitBtn.disabled    = false;
      }, 3000);
    });
  </script>

</body>
</html>
